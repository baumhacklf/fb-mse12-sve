package sve2.fhbay.beans.dao;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.Collection;

import javax.annotation.Resource;
import javax.ejb.EJBException;
import javax.ejb.Stateless;
//import javax.naming.Context;
//import javax.naming.InitialContext;
//import javax.naming.NamingException;
import javax.sql.DataSource;

import sve2.fhbay.domain.Customer;
import sve2.fhbay.interfaces.dao.CustomerDao;
import sve2.fhbay.interfaces.dao.SimpleCustomerDao;
import sve2.fhbay.util.JdbcUtil;

@Stateless
public class CustomerDaoBean implements CustomerDao {

	private DataSource dataSource;
	
	private DataSource getDataSource() {
		return dataSource;
	}
	
	public void setDataSource(DataSource dataSource) {
		this.dataSource = dataSource;
	}
	
  @Override
  public void persist(Customer cust) {
    Connection conn = null;
    PreparedStatement stmt = null;
    try {
      // version 1 (comment out for version 2)
      // DataSource dataSource = getDataSource();
      conn = getDataSource().getConnection();
      stmt = conn
          .prepareStatement("INSERT INTO SimpleCustomer (firstname, lastname, username, password, email) VALUES (?, ?, ?, ?, ?)",
              Statement.RETURN_GENERATED_KEYS);
      stmt.setString(1, cust.getFirstname());
      stmt.setString(2, cust.getLastname());
      stmt.setString(3, cust.getUsername());
      stmt.setString(4, cust.getPassword());
      stmt.setString(5, cust.getEmail()); 
	  
      int rowsAffected = stmt.executeUpdate();
      if (rowsAffected != 1)
        throw new EJBException("Insert into table SimpleCustomer failed.");
      
      cust.setId(JdbcUtil.getUniqueKey(Long.class, stmt));
    }
    catch (SQLException e) {
      throw new EJBException(e);
    }
    finally {
      try {
        if (stmt != null) stmt.close();
        if (conn != null) conn.close();
      }
      catch (SQLException e) {
        throw new EJBException(e);
      }
    }
  }

	@Override
	public Customer findById(Long id) {
		// TODO Auto-generated method stub
		return null;
	}

	@Override
	public Collection<Customer> findAll() {
		// TODO Auto-generated method stub
		return null;
	}

}
